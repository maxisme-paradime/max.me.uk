+++
banner = "/uploads/hugo.jpg"
content = "# Intro\n\nWhat better topic to write about in my first blog post than how I set up my website to write this blog post!\n\n## Why am I writing blog posts?\n\nI have had quite a _self-isolated_ (pardon the term) mentality for most of my career in tech in that I often don't share things I have discovered publicly other than with open source code, so I felt I needed to give back to the community as I have had **so** much help from others be it on [Discord](https://discord.com/), [StackOverflow](https://stackoverflow.com/) or friends and start helping other people out by sharing my knowledge.\n\nI feel that with most of my projects I have spent a lot of time fiddling with things that I wish someone had given me some advice on or pointed me in the right direction before I started.\n\nWhen learning new skills I often forget about how I got there and what I learned along the way, so I wanted somewhere to simply write out my notes in a blog-like format. Which will, in turn, also push me to finish my projects - _final 5% takes as long as the first 95%_ and all.\n\n## Why Hugo and Forestry?\n\nAfter finding a new found love for [Go]() about a year ago I decided to start with a quick Google for _\"static sites in Go\"_ and after confirmation from my friends in the [Go Discord](https://discord.gg/0f1SbxBZjYq9jLBk) server/hive, I decided to use [Hugo](https://gohugo.io/ \"Hugo\") to build my website templates and [Forestry](https://forestry.io) for writing my content.\n\n# Set up\n\nIf you can't be asked to read anything and just want code - here is my [repo](https://m4x.uk/max.me.uk) everything I talk about is there ðŸ™‚.\n\n## Hugo\n\n[Hugo](https://gohugo.io/ \"Hugo\"), I believe, has quite a painful initial learning curve - they say it is because it is so powerful but I am not so sure ðŸ˜….\n\nTo create a site you need to run `$ hugo new site nameofsite`. You can install Hugo on your mac by running `$ brew install hugo` in terminal.\n\nWithin `nameofsite` run `$ git init` and sync with a remote GitHub repository.\n\n### Project Structure\n\nHugo has three main folders within `nameofsite` - `/content`, `/layouts` and `/static`\n\n`/content` is for front matter markdown files and structure for each of your blog pages and is where you will have Forestry put its files.\n\n    /content/_index.md # content for http://127.0.0.1/\n    /content/blog/_index.md # needed for initialising the /blog/ folder\n    /content/blog/my-blog-page.md # content for http://127.0.0.1/blog/my-blog-page/\n\nThe `/layouts` folder is where you put the files for displaying your content in html:\n\n    /layouts/index.html # content from /content/_index.md\n    /layouts/blog/list.html # dynamic content to list all the blog posts at /blog/\t \n    /layouts/blog/single.html # content from /content/blog/*.md \n\nThen you have the more self-explanatory folder `/static/` which is for your `js`, `css`, `images` folders.  They are rendered at the corresponding path minus the `/static/` (e.g. `http://127.0.0.1/css/style.css`) and are to work with your HTML pages in the `/layouts` folder.\n\n## Forestry\n\n[Forestry](https://forestry.io) first needs to connect up to your Github project as it writes the content directly there - so make sure you have `nameofsite` on a Github repo.\n\nForestry has a pretty minimal setup with a section where you create the template of your blogs called **Front Matter**. For my blog pages I have it set up like this:\n\n![](/uploads/screenshot_2020-06-20-forestry-io.png)\n\nThere is then another section (in which you name when setting up) where you create your pages using your templates relative to the `/content` folder on your Github repo. You can then decide whether to save them as drafts (will not be `served` by Hugo but still uploaded to Github) or not. You can also view your site via the forestry server by clicking on the eye icon which is super useful when writing your drafts - set it up at **settings > previews**.\n\n## Docker\n\nI have decided to use docker to support me releasing new versions of my site because; one everyone should ðŸ˜‰ and two I am learning about k8s and swarms at the moment.\n\n### Nginx\n\nHugo builds the static website for you in the directory `public/` by default but you need to convert this folder to a server - this is where NGINX comes in.\n\nFor NGINX we need to create a basic `.conf` file to point to our static content:\n\n**nginx.conf**\n\n    server {\n        listen       8080;\n        listen  [::]:8080;\n        server_name  localhost;\n    \n        gzip on;\n        error_page  404 /usr/share/nginx/html/404.html;\n        location / {\n            root /usr/share/nginx/html;\n            index index.htm index.html;\n            try_files $uri $uri/ $uri.html =404;\n        }\n    }\n\nThis config asks NGINX to listen on port `8080` and points to the static content folder `/usr/share/nginx/html` (this is the default for NGINX - often people use `/var/www/` but seeing as this is in a container - who cares!)\n\n### Docker Image\n\nTo create a Docker image, we need to have a `Dockerfile`.\n\n**Dockerfile**\n\n    FROM woahbase/alpine-hugo AS builder\n    COPY . /\n    RUN hugo\n    \n    FROM nginx:alpine\n    COPY nginx.conf /etc/nginx/conf.d/default.conf\n    COPY --from=builder /public /usr/share/nginx/html/\n\nThis file tells Docker build to first create a temporary container to build our Hugo site (using the command `$ hugo`). After that, it creates an NGINX container used to _host_ the static content and copies the static content without having all the extra Hugo application stuff.\n\nI believe it is really important to try and keep your docker images as small as possible - it reduces storage and bandwidth costs as well as decreasing deployment/development time.\n\n> A friend and colleague who lives in Kenya spends Â£5 a day on a capped 5mbit/s internet connection. It is essential that he doesn't download large docker images.\n\nThe `woahbase/alpine-hugo` image is [38MB](https://hub.docker.com/layers/woahbase/alpine-hugo/latest/images/sha256-3fd7c6cc56b5140d0e77877b6825838e2fcf5bb85c99b0005913b55a2206ecbc?context=explore) which has already been heavily reduced from the `golang:alpine` image at [128MB](https://hub.docker.com/layers/golang/library/golang/alpine/images/sha256-2de21f4fe5c3557c31b716291a7986c0d54abbd282cd7fb43aaa484672b0c855?context=explore). Our NGINX image, however, is [9MB](https://hub.docker.com/layers/nginx/library/nginx/alpine/images/sha256-fa24815c8e52981d8ef01249e17d46dc5367765814d6feed154f1043aa255b8e?context=explore) + the static files generated by Hugo - which is 14 times smaller! ðŸŽ‰ .\n\nFinally, I will leave the deployment of our new docker image up to you - I use a docker swarm + Traefik which I will write a tutorial on soon enough!"
date = 2020-06-14T23:00:00Z
draft = true
image = "/uploads/nasa-q1p7bh3shj8-unsplash.jpg"
meta-description = "How to create a blog with Hugo and Forestry"
meta_description = "Building a blog with Hugo and Forestry"
tags = ["Hugo", "Forestry", "NGINX", "Docker", "Actions"]
title = "Creating My Blog"

+++
