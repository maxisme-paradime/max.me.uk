+++
banner = "/uploads/hugo.jpg"
content = "# Intro\n\n## Why am I writing blog posts?\n\nI have had a _self-isolated_ mentality for most of my career in tech where I often don't share things I have discovered publicly other than with open source code and word of mouth between friends and colleagues. I felt I needed to give back to the community as I have had **so** much help from others be it on [Discord](https://discord.com/), [StackOverflow](https://stackoverflow.com/) or friends.\n\nI feel that with most of my personal projects I spend a lot of time fiddling with things that I wish someone had given me some advice on or pointed me in the right direction before I started.\n\nWhen learning new skills I often forget about how I got there and what I learned along the way, so I wanted somewhere to simply write out my notes in a blog-like format. Which will, in turn, also push me to finish my projects - \"the _final 5% takes as long as the first 95%_\"\n\n## Why Hugo and Forestry?\n\nAfter finding a new found love for [Go]() about a year ago I decided to start with a quick Google for _\"static sites in Go\"_ and after confirmation from my friends in the [Go Discord](https://discord.gg/0f1SbxBZjYq9jLBk) server/hive, I decided to use [Hugo](https://gohugo.io/ \"Hugo\") to build my website templates and [Forestry](https://forestry.io) for writing my content.\n\n# Set up\n\nIf you can't be asked to read anything and just want code - here is my [repo](https://m4x.uk/max.me.uk) everything I talk about is there ðŸ™‚.\n\n## Hugo\n\n[Hugo](https://gohugo.io/ \"Hugo\"), I believe, has quite a painful initial learning curve - they say it is because it is so powerful but I am not so sure ðŸ˜….\n\nTo create a new site you need to run `$ hugo new site nameofsite`. You can install Hugo on your mac by running `$ brew install hugo` in the terminal.\n\nThen within `nameofsite` run `$ git init` and sync with a remote GitHub repository (for Forrestry).\n\n### Project Structure\n\nHugo has three main folders within `nameofsite` - `/content`, `/layouts` and `/static`\n\n`/content` is for front matter markdown files and structure for each of your blog pages and is where you will have Forestry put your posts.\n\n    /content/_index.md # content for http://127.0.0.1/\n    /content/blog/_index.md # needed for initialising the /blog/ folder\n    /content/blog/my-blog-page.md # content for http://127.0.0.1/blog/my-blog-page/\n\nThe `/layouts` folder is where you put the template files for displaying your content in HTML:\n\n    /layouts/index.html # with content from /content/_index.md\n    /layouts/blog/list.html # dynamic content to list all the blog posts at /blog/\t \n    /layouts/blog/single.html # with content from /content/blog/*.md \n\nFinally, you have the more self-explanatory folder `/static/` which is for your `js`, `css`, `images` folders.  They are rendered at the corresponding path minus the `/static/` (e.g. `http://127.0.0.1/css/style.css`) and are to work with your HTML pages from the `/layouts` folder.\n\n## Forestry\n\n[Forestry](https://forestry.io) first needs to connect up to your GitHub project as it writes the content directly there - so make sure you have `nameofsite` on a GitHub repo.\n\nForestry has a pretty minimal setup with a section where you create the template of your blogs called **Front Matter**. For my blog pages I have it set up like this:\n\n![](/uploads/screenshot_2020-06-20-forestry-io.png)\n\nThere is then another section (in which you name when setting up) where you create pages using your templates, relative to the `/content` folder, on your GitHub repo.\n\n#### Drafts\n\nYou can decide whether to save your pages as drafts where they will not directly be `served` by Hugo but still uploaded to GitHub. They can then be viewed via forestry by clicking the eye icon at the top right after setting up at **settings > previews**.\n\n## Docker\n\nI have decided to use docker to help me release new versions of my site. This is arguably overkill as Docker is really meant for the infrastructure of your application and not the static files which should just be mounted into the container. But it is pretty easy to set up and release and doesn't cost a dime apart from taking longer to deploy changes and require your server to download more than it needs to every time.\n\n### Nginx\n\nHugo builds the static website in the directory `public/` by default but you need to convert this folder to a web server - this is where NGINX comes in.\n\nFor NGINX we need to create a basic `.conf` file to point to our static content (`public/`)\n\n**nginx.conf**\n\n    server {\n        listen       8080;\n        listen  [::]:8080;\n        server_name  localhost;\n    \n        gzip on;\n        location / {\n            root /usr/share/nginx/html;\n            index index.htm index.html;\n            try_files $uri $uri/ $uri.html =404;\n        }\n    }\n\nThis config asks NGINX to listen on port `8080` and points to the static content folder `/usr/share/nginx/html` (this is the default for NGINX - often people use `/var/www/` but seeing as this is in a container - who cares!)\n\n### Docker Image\n\nTo create a Docker image, we need to have a `Dockerfile`.\n\n**Dockerfile**\n\n    FROM woahbase/alpine-hugo AS builder\n    COPY . /\n    RUN hugo --minify\n    \n    FROM nginx:alpine\n    COPY nginx.conf /etc/nginx/conf.d/default.conf\n    COPY --from=builder /public /usr/share/nginx/html/\n\nThis file tells Docker-build to first create a temporary container to build our Hugo site (using the command `$ hugo --minify`).\n\nAfter that, the Dockerfile creates an NGINX container used to _host_ the static content and copies the static content without having all the extra Hugo application stuff to build and test the Hugo application. (This is where we could just export the output of `hugo --minify` to some mount point)\n\n***\n\nI believe it is really important to try and keep your docker images as small as possible - it reduces storage and bandwidth costs as well as decreasing deployment/development time.\n\n> A friend and colleague who lives in Uganda spends Â£5 a day on a capped 5mbit/s internet connection. It is essential that he doesn't download large docker images.\n\nThe `woahbase/alpine-hugo` image is [38MB](https://hub.docker.com/layers/woahbase/alpine-hugo/latest/images/sha256-3fd7c6cc56b5140d0e77877b6825838e2fcf5bb85c99b0005913b55a2206ecbc?context=explore) which has already been heavily reduced from the `golang:alpine` image at [128MB](https://hub.docker.com/layers/golang/library/golang/alpine/images/sha256-2de21f4fe5c3557c31b716291a7986c0d54abbd282cd7fb43aaa484672b0c855?context=explore). Our NGINX image, however, is [9MB](https://hub.docker.com/layers/nginx/library/nginx/alpine/images/sha256-fa24815c8e52981d8ef01249e17d46dc5367765814d6feed154f1043aa255b8e?context=explore) + the static files generated by Hugo - which is \\~14 times smaller! ðŸŽ‰\n\nFinally, I will leave the deployment of our new docker image up to you - I use a docker swarm + Traefik which I will write a tutorial on it soon enough!"
date = 2020-08-12T00:00:00Z
image = "/uploads/nasa-q1p7bh3shj8-unsplash.jpg"
meta-description = "How to create a blog with Hugo and Forestry"
meta_description = "Building a blog with Hugo and Forestry."
tags = ["Hugo", "Forestry", "NGINX", "Docker", "Actions"]
title = "Creating My Blog"

+++
