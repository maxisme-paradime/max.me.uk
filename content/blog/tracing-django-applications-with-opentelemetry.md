+++
banner = ""
content = "# Intro\n\nTracing is a fantastic way to monitor your application that uses different services... so basically every production application ðŸ˜„.\n\nIn tracing there are two fundamental concepts; traces and spans. You can think of a trace as a specific request so every HTTP call will have a unique trace ID. A trace then has many spans that monitor the bits of work within the request for example a database call.\n\n\\[PUT IMAGE HERE\\]\n\nTracing makes it very easy to debug any errors as well as monitoring the performance of your application. Latency analysis is very important when you are running any sort of application that has been horizontally scaled (basically every production application). If your application slows down it can be hard to work out where the bottleneck is. With tracing you can analyze each span to find out how long it took so if you have a single un-sharded database that is hosted in Sydney while the rest of your application is hosted in London the database request spans will potentially be a lot longer than you would want. The same as if your database is under too much load it will make your spans longer. Obviously it does not tell you whether the database is under a large load specifically but it points you in the right direction and is better than just being told: \"the page is slow\".\n\n# Tools\n\n## [OpenTelemetry](https://opentelemetry.io/)\n\nOpenTelemetry is used to create your traces and spans and send them to Jaeger. It is still in Beta so things can still change a lot but I wanted to use it in my personal applications as it simplifies the workload and is the future of tracing:\n\n> A single set of APIs, libraries, agents, and collector services to capture distributed traces and metrics from your application.\n\n## [Jaeger](https://www.jaegertracing.io/)\n\nJaeger is a tool to visualize your traces.\n\n## [Elasticsearch](https://www.elastic.co/)\n\nUsed to store your traces (handled by Jaeger)\n\n## [Traefik](https://containo.us/traefik/)\n\nUsed as a proxy for your Django application. As well as starting the traces using OpenTracing, **not** OpenTelemetry.\n\n# Implementation\n\nSo a request to my Django application will look like this:  \nTraefik -> Gunicorn -> Django\n\n## Jaeger\n\nWe need a [jaeger-agent](https://www.jaegertracing.io/docs/1.18/deployment/#agent) - used to handle the traces and spans and a [jaeger-colector]() used to store them. In my swarm I simply have:\n\n     jaeger-collector:\n        image: jaegertracing/jaeger-collector\n        environment:\n          - \"SPAN_STORAGE_TYPE=elasticsearch\"\n          - \"ES_SERVER_URLS=http://elasticsearch:9200\"\n          - \"JAEGER_REPORTER_LOG_SPANS=true\"\n        networks:\n          - tracing\n          \n      jaeger-query:\n        image: jaegertracing/jaeger-query\n        environment:\n          - \"SPAN_STORAGE_TYPE=elasticsearch\"\n          - \"ES_SERVER_URLS=http://elasticsearch:9200\"\n        networks:\n          - tracing\n\n## Traefik\n\nTo trace Traefik requests you need to add this to your .toml (or [.yml](https://docs.traefik.io/observability/tracing/jaeger/)):\n\n    [tracing]\n        [tracing.jaeger]\n            propagation = \"b3\"\n            gen128Bit = true\n            [tracing.jaeger.collector]\n                endpoint = \"http://jaeger-collector:14268/api/traces?format=jaeger.thrift\"\n\n## Django\n\nTo run my Django application in production I use [Gunicorn](https://gunicorn.org/) along with the Djangos WSGI handler. This makes the first port of call after the Traefik proxy the WSGI handler so that is where you need to start/continue the trace from. You can do this by adding:\n\n_wsgi.py_\n\n    ...\n    application = get_wsgi_application()\n    application = OpenTelemetryMiddleware(application)\n\nYou will then have a trace for every Django request.\n\nUnfortunately these traces have no link to"
date = 2020-07-29T00:00:00Z
draft = true
meta_description = "How to trace a Django application with OpenTelemetry and Jaeger."
tags = ["Django", "OpenTelemetry", "Traefik", "Tracing", "Jaeger"]
title = "Tracing Django applications"

+++
