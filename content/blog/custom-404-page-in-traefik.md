+++
banner = ""
content = "# Intro\n\nThere are two different places a 404 page is likely to come up when using Traefik. \n\nThe first one is when Traefik does not know where to forward your request because you haven't set up a router for a route (e.g. pointing a random domain to your Traefik IP address with no corresponding router rule).\n\nThe second is when a service on Traefik returns a 404 (e.g. an NGINX service).\n\n# Setup\n\n## Creating a 404 service\n\n### Golang\n\nFirst I wrote a basic server that returns a static 404 page.\n\n_main.go_\n\n    package main\n    \n    import (\n    \t\"io/ioutil\"\n    \t\"log\"\n    \t\"net/http\"\n    \t\"os\"\n    \t\"path/filepath\"\n    )\n    \n    func main() {\n    \tdir, _ := filepath.Abs(filepath.Dir(os.Args[0]))\n    \tfile, _ := ioutil.ReadFile(dir + \"/static/404.html\")\n    \thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    \t\tw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n    \t\tw.WriteHeader(http.StatusNotFound)\n    \t\t_, _ = w.Write(file)\n    \t})\n    \tlog.Fatal(http.ListenAndServe(\":8080\", nil))\n    }\n    \n\n### Docker\n\nI then wrote a Dockerfile to containerise my Go application and uploaded to Docker Hub - `maxisme/404`\n\n_Dockerfile_\n\n    FROM golang:alpine AS builder\n    ADD . /app/\n    WORKDIR /app\n    RUN go build -o app\n    \n    FROM alpine\n    WORKDIR /app\n    COPY --from=builder /app /app\n    CMD [\"./app\"]\n\nThen in my swarm, I created the service:\n\n_stack.yml_\n\n      missing:\n        image: maxisme/404:latest\n        deploy:\n          mode: global\n          labels:\n            - \"traefik.enable=true\"\n            - \"traefik.http.routers.404.rule=HostRegexp(`{catchall:.*}`)\"\n            - \"traefik.http.routers.404.priority=1\"\n            - \"traefik.http.routers.404.entrypoints=web-secure\"\n            - \"traefik.http.routers.404.tls.certresolver=letsencrypt\"\n            - \"traefik.http.services.404.loadbalancer.server.port=8080\"\n        networks:\n          - traefik\n\nThe lines:\n\n    - \"traefik.http.routers.404.rule=HostRegexp(`{catchall:.*}`)\"\n    - \"traefik.http.routers.404.priority=1\"\n\napplies to all rules "
date = 2020-06-25T00:00:00Z
draft = true
meta_description = "Setting up a custom 404 page in Traefik"
tags = ["Traefik", "404"]
title = "Custom 404 Page in Traefik"

+++
